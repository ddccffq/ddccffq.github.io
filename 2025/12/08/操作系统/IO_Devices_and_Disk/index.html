

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="ddccffq">
  <meta name="keywords" content="���,�㷨,����ѧϰ,���������,��������,��������,ѧϰ�ʼ�">
  
    <meta name="description" content="I&#x2F;O Devices   The old architecture of computer IO    Figure 1: The old architecture of computer IO    The modern architecture of computer IO    Figure 2: The modern architecture of computer IO  A sim">
<meta property="og:type" content="article">
<meta property="og:title" content="IO Devices and Disk">
<meta property="og:url" content="https://ddccffq.github.io/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/index.html">
<meta property="og:site_name" content="ddccffq&#39;s Blog">
<meta property="og:description" content="I&#x2F;O Devices   The old architecture of computer IO    Figure 1: The old architecture of computer IO    The modern architecture of computer IO    Figure 2: The modern architecture of computer IO  A sim">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ddccffq.github.io/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/The%20old%20architecture%20of%20computer%20IO.png">
<meta property="og:image" content="https://ddccffq.github.io/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/The%20modern%20architecture%20of%20computer%20IO.png">
<meta property="og:image" content="https://ddccffq.github.io/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/A%20simple%20IO%20device%20structure.png">
<meta property="og:image" content="https://ddccffq.github.io/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/Magnetic%20disk%20physical%20structure.png">
<meta property="article:published_time" content="2025-12-08T08:00:00.000Z">
<meta property="article:modified_time" content="2025-12-19T13:12:15.028Z">
<meta property="article:author" content="ddccffq">
<meta property="article:tag" content="���,�㷨,����ѧϰ,���������,��������,��������,ѧϰ�ʼ�">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ddccffq.github.io/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/The%20old%20architecture%20of%20computer%20IO.png">
  
  
  
  <title>IO Devices and Disk - ddccffq&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"ddccffq.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="IO Devices and Disk"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-12-08 16:00" pubdate>
          2025年12月8日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          475 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          4 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">IO Devices and Disk</h1>
            
            
              <div class="markdown-body">
                
                <span id="more"></span>
<h2 id="io-devices">I/O Devices</h2>
<div style="display: block; margin: 0 auto; width: fit-content">
<figure>
<img src="/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/The%20old%20architecture%20of%20computer%20IO.png" srcset="/img/loading.gif" lazyload alt="The old architecture of computer IO"><figcaption aria-hidden="true">The old architecture of computer IO</figcaption>
</figure>
</div>
<div style="text-align: center; font-style: italic;">
Figure 1: The old architecture of computer IO
</div>
<div style="display: block; margin: 0 auto; width: fit-content">
<figure>
<img src="/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/The%20modern%20architecture%20of%20computer%20IO.png" srcset="/img/loading.gif" lazyload alt="The modern architecture of computer IO"><figcaption aria-hidden="true">The modern architecture of computer IO</figcaption>
</figure>
</div>
<div style="text-align: center; font-style: italic;">
Figure 2: The modern architecture of computer IO
</div>
<p>A simple IO device should have two parts:</p>
<ol type="1">
<li>Interface.</li>
<li>Internal structure.
<ul>
<li>Implementation specific and is responsible for implementing the abstraction the device presents to the system.</li>
<li>Complex devices could have their own CPU and memory as well.</li>
</ul></li>
</ol>
<div style="display: block; margin: 0 auto; width: fit-content">
<figure>
<img src="/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/A%20simple%20IO%20device%20structure.png" srcset="/img/loading.gif" lazyload alt="A simple IO device structure"><figcaption aria-hidden="true">A simple IO device structure</figcaption>
</figure>
</div>
<div style="text-align: center; font-style: italic;">
Figure 3: A simple IO device structure
</div>
<ul>
<li>A <strong>status</strong> register, which can be read to see the current status of the device;</li>
<li>A <strong>command</strong> register, to tell the device to perform a certain task;</li>
<li>A <strong>data</strong> register to pass data to the device, or get data from the device.</li>
</ul>
<blockquote>
<p>An example code may be like:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">While (STATUS == BUSY)<br>; <span class="hljs-comment">// wait until device is not busy</span><br></code></pre></td></tr></table></figure>
<p>But polling is inefficient. We use interrupts instead of polling.</p>
</blockquote>
<h3 id="direct-memory-access">Direct Memory Access</h3>
<p>A <strong>DMA engine</strong> is a very specific device that can orchestrate transfers between devices and main memory without much CPU intervention.</p>
<blockquote>
<p>To transfer data to the device, for example, the OS would program the DMA engine by telling it where the data lives in memory, how much data to copy, and which device to send it to. At that point, the OS is done with the transfer and can proceed with other work.When the DMA is complete, the DMA controller raises an interrupt, and the OS thus knows the transfer is complete.</p>
</blockquote>
<p>There are two complementary ways for CPU to access I/O devices.</p>
<blockquote>
<p>I/O devices have their own registers (or memory).</p>
</blockquote>
<ol type="1">
<li>Memory-mapped I/O (MMIO): let memory and devices share the physical address space
<ul>
<li>Most widely adopted.</li>
<li>Shared address bus.</li>
</ul></li>
<li>Port-mapped I/O (PMIO), or isolated I/O: use specialized instructions to R/W I/O devices.
<ul>
<li>In Intel: outb, outw, etc.</li>
</ul></li>
</ol>
<h2 id="storage-devices">Storage Devices</h2>
<blockquote>
<p>Second storage:</p>
<ul>
<li>Magnetic disk: hard disk, floppy disk, etc.</li>
<li>Optical disk: CD, DVD, blu-ray, etc.</li>
<li>Flash memory: pen drive, SD card, etc.</li>
</ul>
</blockquote>
<p>Storage devices:</p>
<ol type="1">
<li>Magnetic disks
<ul>
<li>Storage that rarely becomes corrupted.</li>
<li>Large capacity at low cost.</li>
<li>Block level random access.</li>
<li>Slow performance for random access.</li>
<li>Better performance for sequential access.</li>
</ul></li>
<li>Flash memory
<ul>
<li>Storage that rarely becomes corrupted.</li>
<li>Capacity at intermediate cos (5 - 20x disk).</li>
<li>Block level random access.</li>
<li>Good performance for reads; worse for random writes.</li>
<li>Erasure requirement in large blocks.</li>
<li>Wear patterns issue.</li>
</ul></li>
</ol>
<h3 id="the-magnetic-disk">The Magnetic Disk</h3>
<ul>
<li>Sector: the unit of transfer.</li>
<li>Track: ring of sectors
<ul>
<li>~ <span class="math inline">\(1\)</span> um (<span class="math inline">\(10^{-6}\)</span> m) wide.
<ul>
<li>Resolution of human eye: <span class="math inline">\(50\)</span> um</li>
<li>Wavelength of lights is ~ <span class="math inline">\(0.5\)</span> um.</li>
</ul></li>
</ul></li>
<li>Cylinder: attached to movable arms to read data.
<ul>
<li><span class="math inline">\(2\)</span> per each platter for each surface.</li>
</ul></li>
<li>Storage capacity <span class="math inline">\(=\)</span> (head #) <span class="math inline">\(\times\)</span> (cylinder #) <span class="math inline">\(\times\)</span> (sector #) <span class="math inline">\(\times\)</span> (sector size)
<ul>
<li>Often <span class="math inline">\(512\)</span> bytes.</li>
</ul></li>
</ul>
<div style="display: block; margin: 0 auto; width: fit-content">
<figure>
<img src="/2025/12/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/IO_Devices_and_Disk/Magnetic%20disk%20physical%20structure.png" srcset="/img/loading.gif" lazyload alt="Magnetic disk physical structure"><figcaption aria-hidden="true">Magnetic disk physical structure</figcaption>
</figure>
</div>
<div style="text-align: center; font-style: italic;">
Figure 4: Magnetic disk physical structure
</div>
<p>Cylinders: all the tracks under the head at a given point on all surface.</p>
<p>Read/write data is a three-stage process:</p>
<ul>
<li>Seek time: position the <strong>head/arm</strong> over the <strong>proper track</strong>.</li>
<li>Rotation latency: wait for <strong>desired sector</strong> to rotate under r/w head.</li>
<li>Transfer time: transfer <strong>a block of bits</strong> (sector) under r/w head.</li>
</ul>
<p>Disk latency <span class="math inline">\(=\)</span> queuing time + controller time + seek time + rotation time + transfer time.</p>
<blockquote>
<p>Request <span class="math inline">\(\to\)</span> Software Queue <span class="math inline">\(\to\)</span> Hardware Controller <span class="math inline">\(\to\)</span> Media Time <span class="math inline">\(\to\)</span> Result</p>
</blockquote>
<p>Here is a disk performance example. We assume that</p>
<ul>
<li>Ignoring queuing and controller times for now.</li>
<li>Avg seek time of <span class="math inline">\(5\)</span> ms.</li>
<li><span class="math inline">\(7200\)</span> RPM <span class="math inline">\(\Rightarrow\)</span> time for rotation: <span class="math inline">\(60000\)</span> (ms/min) / <span class="math inline">\(7200\)</span> (rev/min) <span class="math inline">\(\approx\)</span> <span class="math inline">\(8\)</span> ms.</li>
<li>Transfer rate of <span class="math inline">\(4\)</span> MByte/s, sector size of <span class="math inline">\(1\)</span> KByte <span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(1024\)</span> bytes / <span class="math inline">\(4 \times 10^6\)</span> (bytes/s) <span class="math inline">\(= 256 \times 10^{-6}\)</span> sec <span class="math inline">\(\approx 0.26\)</span> ms.</li>
</ul>
<p>Read sector from random place on disk:</p>
<ul>
<li>Seek (<span class="math inline">\(5\)</span> ms) + Rot.Delay (<span class="math inline">\(4\)</span> ms) + Transfer (<span class="math inline">\(0.26\)</span> ms) <span class="math inline">\(= 9.26\)</span> ms.</li>
<li>Approx <span class="math inline">\(10\)</span> ms to fetch/put data: <span class="math inline">\(100\)</span> KByte/sec.</li>
</ul>
<p>Read sector from random place in same cylinder:</p>
<ul>
<li>Rot.Delay (<span class="math inline">\(4\)</span> ms) + Transfer (<span class="math inline">\(0.26\)</span> ms) <span class="math inline">\(= 4.26\)</span> ms.</li>
<li>Approx <span class="math inline">\(5\)</span> ms to fetch/put data: <span class="math inline">\(200\)</span> KByte/sec.</li>
</ul>
<p>Read next sector on same track:</p>
<ul>
<li>Transfer (<span class="math inline">\(0.26\)</span> ms): <span class="math inline">\(4\)</span> MByte/sec.</li>
</ul>
<h3 id="intelligence-in-the-controller">Intelligence in the Controller</h3>
<ul>
<li>Sectors contain sophisticated error correcting codes
<ul>
<li>Disk head magnet has a field wider than track.</li>
<li>Hide corruptions due to neighboring track writes.</li>
</ul></li>
<li>Sector sparing
<ul>
<li>Remap bad sectors transparently to spare sectors on the same surface.</li>
</ul></li>
<li>Slip sparing
<ul>
<li>Remap all sectors (when there is a bad sector) to preserve sequential behavior.</li>
</ul></li>
<li>Track skewing
<ul>
<li>Sector numbers offset from one track to the next, to allow for disk head movement for sequential ops.</li>
</ul></li>
</ul>
<h3 id="solid-state-disks-ssds">Solid State Disks (SSDs)</h3>
<blockquote>
<ul>
<li><p>1995 – Replace magnetic media with non-volatile memory (battery backed DRAM)</p></li>
<li><p>2009 – Use NAND Multi-Level Cell (2 or 3-bit/cell) flash memory</p>
<ul>
<li>Sector (4 KB page) addressable, but stores 4-64 ”pages” per memory block.</li>
<li>Trapped electrons distinguish between 1 and 0.</li>
</ul></li>
<li><p>No moving parts (no rotate/seek motors)</p>
<ul>
<li>Eliminates seek and rotational delay (0.1-0.2ms access time)</li>
<li>Very low power and lightweight</li>
<li>Limited “write cycles”</li>
</ul></li>
<li><p>Rapid advances in capacity and cost ever since!</p></li>
</ul>
</blockquote>
<p>SSD architecture</p>
<ul>
<li>Read <span class="math inline">\(4\)</span> KB page: <span class="math inline">\(\sim 25\)</span> <span class="math inline">\(\mu\)</span>s
<ul>
<li>No seek or rotational latency.</li>
<li>Transfer time: transfer a <span class="math inline">\(4\)</span> KB page
<ul>
<li>SATA: <span class="math inline">\(300\)</span> - <span class="math inline">\(600\)</span> MB/s <span class="math inline">\(\Rightarrow \sim 4 \times 10^3\)</span> b / <span class="math inline">\(400 \times 10^6\)</span> bps <span class="math inline">\(\Rightarrow 10\)</span> <span class="math inline">\(\mu\)</span>s</li>
</ul></li>
</ul></li>
<li>Writing data is complex (<span class="math inline">\(\sim 200\)</span> <span class="math inline">\(\mu\)</span>s - <span class="math inline">\(1.7\)</span> ms)
<ul>
<li>Can only write empty pages in a block.</li>
<li>Erasing a block takes <span class="math inline">\(\sim 1.5\)</span> ms.</li>
<li>Controller maintains pool of empty blocks by coalescing used pages (read, erase, write), also reserves some <span class="math inline">\(\%\)</span> of capacity.</li>
</ul></li>
<li>Rule of thumb: writes <span class="math inline">\(10\)</span>x reads, erasure <span class="math inline">\(10\)</span>x writes</li>
</ul>
<p>SSD summary:</p>
<ul>
<li>Pros (compared to hard disk drives):
<ul>
<li>Low latency, high throughput (eliminate seek/rotational delay).</li>
<li>No moving parts:
<ul>
<li>Very light weight, low power, silent, very shock insensitive.</li>
</ul></li>
<li>Read at memory speeds (limited by controller and I/O bus)</li>
</ul></li>
<li>Cons
<ul>
<li>Asymmetric block write performance: read pg/erase/write pg
<ul>
<li>Controller garbage collection (GC) algorithms have major effect on performance</li>
</ul></li>
<li>Limited drive lifetime
<ul>
<li><span class="math inline">\(1\)</span> - <span class="math inline">\(10\)</span> K writes/page for MLC NAND</li>
<li>Avg failure rate is <span class="math inline">\(6\)</span> years, life expectancy is <span class="math inline">\(9\)</span> – <span class="math inline">\(11\)</span> years</li>
</ul></li>
</ul></li>
</ul>
<h3 id="disk-scheduling">Disk Scheduling</h3>
<p>Disk can do only one request at a time. What order do you choose to do queued requests?</p>
<blockquote>
<p>The scheduling can be done in OS, firmware, or both.</p>
</blockquote>
<ul>
<li>FIFO
<ul>
<li>Fair among requesters, but order of arrival may be to random spots on the disk <span class="math inline">\(\Rightarrow\)</span> Very long seeks.</li>
</ul></li>
<li>SSTF: shortest seek time first
<ul>
<li>Pick the request that’s closest on the disk</li>
<li>Although called SSTF, today must include rotational delay in calculation, since rotation can be as long as seek</li>
<li>Con: SSTF good at reducing seeks, but may lead to starvation</li>
</ul></li>
<li>SCAN
<ul>
<li>Implements an Elevator Algorithm: take the closest request in a fixed direction of travel (reversed at the end)</li>
<li>No starvation, but retains flavor of SSTF</li>
</ul></li>
<li>C-SCAN: circular-scan
<ul>
<li>Only goes in one direction</li>
<li>Skips any requests on the way back</li>
<li>Fairer than SCAN, not biased towards pages in middle</li>
</ul></li>
</ul>
<blockquote>
<p>A simple read() lifecycle</p>
<ul>
<li>A process issues a syscall read()</li>
<li>OS moves the calling thread to a wait queue (state=WAITING)</li>
<li>OS uses memory-mapped I/O to tell the disk to read the requested data and set up DMA so the disk can place the data in kernel’s memory</li>
<li>Disk reads the data and DMAs it into main memory</li>
<li>Disk triggers an interrupt</li>
<li>OS’s interrupt handler copies the data from the kernel’s buffer into the process’s address space</li>
<li>OS moves the thread to the ready list</li>
<li>The thread is scheduled on CPU, and returns from the read()</li>
</ul>
</blockquote>
<h2 id="file-system-abstraction">File System Abstraction</h2>
<blockquote>
<p>How files and directories are organized in memory and disk.</p>
</blockquote>
<p><strong>Def</strong>. <strong>File system</strong> is a layer of OS that transforms block interface of disks (or other block devices) into <strong>files</strong>, <strong>directories</strong>, etc.</p>
<p>File system components:</p>
<ul>
<li><strong>Naming</strong>: interface to find files by name, not by blocks.</li>
<li><strong>Disk management</strong>: collecting disk blocks into files.</li>
<li><strong>Protection</strong>: layers to keep data secure.</li>
<li><strong>Reliability/Durability</strong>: keeping of files despite crashes, media failures, attacks, etc.</li>
</ul>
<h3 id="disk-management-policies">Disk Management Policies</h3>
<ul>
<li>Basic entities on a disk:
<ul>
<li>Files: user-visible group of blocks arranged sequentially in logical space.</li>
<li>Directory: user-visible index mapping names to files.</li>
</ul></li>
<li>Access disks as linear array of sectors. Two options;
<ul>
<li>Identify sectors as vectors [cylinder, surface, sector], sort in cylinder-major order
<ul>
<li>Used in BIOS, but not in OSes anymore</li>
</ul></li>
<li>Logical Block Addressing: Every sector has integer address from zero up to max number of sectors</li>
<li>Controller translates from address <span class="math inline">\(\Rightarrow\)</span> physical position
<ul>
<li>First case: OS/BIOS must deal with bad sectors</li>
<li>Second case: hardware shields OS from structure of disk</li>
</ul></li>
</ul></li>
<li>Need way to track free disk blocks
<ul>
<li>Link free blocks together <span class="math inline">\(\Rightarrow\)</span> too slow today</li>
<li>Use bitmap to represent free space on disk</li>
</ul></li>
<li>Need way to structure files: file header
<ul>
<li>Track which blocks belong at which offsets within the logical file str ucture</li>
<li>Optimize placement of files’ disk blocks to match access and usage patterns</li>
</ul></li>
</ul>
<h2 id="file">File</h2>
<ul>
<li>Named permanent storage</li>
<li>Contains
<ul>
<li>Data
<ul>
<li>Blocks on disk somewhere</li>
</ul></li>
<li>Metadata (attributes)
<ul>
<li>Owner, size, last opened</li>
<li>Access rights
<ul>
<li>R, W, X</li>
<li>Owner, group, other (in Unix systems)</li>
<li>Access control list in Windows system.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<h2 id="directory">Directory</h2>
<ul>
<li>Basically a hierarchical structure</li>
<li>Each directory entry is a collection of
<ul>
<li>Files</li>
<li>Directories
<ul>
<li>A link to another entries</li>
</ul></li>
</ul></li>
<li>Each has a name and attributes.
<ul>
<li>Files have data</li>
</ul></li>
<li>Links (hard links) make it a DAG, not just a tree
<ul>
<li>Softlinks (aliases) are another name for an entry.</li>
</ul></li>
<li>Conventions of directory
<ul>
<li>Root directory: “/”</li>
<li>Home directory: “~/cur_dir/file.txt”</li>
<li>Absolute path: “/home/mwx/cur_dir/file.txt”</li>
<li>Relative path: “file.txt”</li>
<li>Volume: a collection of physical storage resources that form a logical storage device. Could be a part of or many physical devices.</li>
<li>Mount: an operation that creates a mapping from some path in the existing file system to the root directory of the mounted volume’s file system</li>
</ul></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/The-Operating-System/" class="category-chain-item">The Operating System</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>IO Devices and Disk</div>
      <div>https://ddccffq.github.io/2025/12/08/操作系统/IO_Devices_and_Disk/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>ddccffq</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年12月8日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/12/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/FS_Design/" title="FS Design">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">FS Design</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/12/07/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/Query_Processing/" title="Query Processing">
                        <span class="hidden-mobile">Query Processing</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"ddccffq/ddccffq.github.io","repo-id":"R_kgDOPtFBqg","category":"Announcements","category-id":"DIC_kwDOPtFBqs4CvlN9","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"bottom","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <br> <span>&copy; 2025 <a href="https://github.com/ddccffq" target="_blank">ddccffq</a>. All Rights Reserved.</span> <br> <span style="font-size: 12px; color: #999;">用代码改变世界，以技术创造价值</span> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
